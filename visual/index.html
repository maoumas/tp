<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Teleprompter Pro V7</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
    
    <style>
        :root {
            --bg-app: #000000;
            --text-main: #ffffff;
            --panel-bg: #1a1a1a;
            --accent-green: #2ecc71;
            --accent-red: #e74c3c;
            --accent-blue: #3498db;
            --accent-orange: #e67e22;
            --accent-purple: #9b59b6;
            --link-color: #FFD700; /* Amarillo Oro para enlaces */
            --header-height: 60px;
            --footer-height: 90px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-app);
            color: var(--text-main);
            height: 100dvh;
            width: 100vw;
            overflow: hidden;
        }

        /* --- SVG CONFIG --- */
        svg { width: 24px; height: 24px; fill: currentColor; display: block; }

        /* --- BARRA SUPERIOR --- */
        .top-bar {
            position: fixed; top: 0; left: 0; width: 100%; height: var(--header-height);
            background-color: var(--panel-bg); border-bottom: 1px solid #333;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; padding-top: env(safe-area-inset-top); z-index: 1000;
        }
        .logo { font-weight: bold; font-size: 1.1rem; display: flex; align-items: center; gap: 8px; color: white; }
        
        .header-actions { display: flex; gap: 10px; }
        
        .btn-header {
            background: #333; color: white; border: 1px solid #555;
            padding: 6px 12px; border-radius: 6px; font-size: 0.85rem; cursor: pointer;
            display: flex; align-items: center; gap: 6px;
        }
        .btn-header:active { background: #555; }

        /* --- BARRA INFERIOR --- */
        .control-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background-color: var(--panel-bg); border-top: 1px solid #333;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            padding: 10px; padding-bottom: calc(15px + env(safe-area-inset-bottom));
            z-index: 1000; box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
        }

        .btn {
            border: none; color: white; font-weight: bold; border-radius: 10px;
            height: 46px; width: 46px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; flex-shrink: 0; font-size: 1.1rem;
        }
        .btn:active { transform: scale(0.95); opacity: 0.8; }
        
        .control-group {
            display: flex; background: #000; border-radius: 10px;
            border: 1px solid #333; overflow: hidden; align-items: center; height: 46px;
        }
        .display-val { width: 30px; text-align: center; font-size: 0.9rem; color: #ffffff; font-weight: bold; }
        .btn-mini { width: 40px; height: 100%; background: transparent; color: white; border: none; font-weight: bold; font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center;}
        .btn-mini:active { background-color: rgba(255,255,255,0.1); }

        .btn-start { background-color: var(--accent-green); width: 60px; }
        .btn-start.paused { background-color: var(--accent-red); }
        .btn-reset { background-color: #444; }
        .bg-blue { background-color: var(--accent-blue); }
        .bg-orange { background-color: var(--accent-orange); }
        .btn-save { background-color: var(--accent-purple); margin-left: auto;}

        /* --- √ÅREA CENTRAL --- */
        #teleprompter-area {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            overflow-y: auto; scroll-behavior: auto;
            padding-top: calc(var(--header-height) + 20px);
            padding-bottom: calc(var(--footer-height) + 80px);
            padding-left: 20px; padding-right: 20px;
            -webkit-overflow-scrolling: touch; outline: none;
        }

        .content-width {
            max-width: 900px; margin: 0 auto; line-height: 1.6; font-weight: 500; margin-top: 20vh; 
        }

        /* --- ESTILOS MARKDOWN --- */
        .markdown-body h1 { color: #ffeaa7; margin-top: 1.5em; font-size: 1.8em; border-bottom: 1px solid #333; padding-bottom: 10px;}
        .markdown-body h2 { color: #ffeaa7; margin-top: 1.2em; font-size: 1.4em; }
        .markdown-body p { margin-bottom: 1.5em; text-align: left; }
        .markdown-body ul { margin-left: 1.5em; margin-bottom: 1.5em; color: #ccc; }
        .markdown-body code { background: #333; padding: 2px 6px; border-radius: 4px; font-family: monospace; color: #f1c40f;}
        
        /* CORRECCI√ìN DE COLOR DE ENLACES */
        .markdown-body a {
            color: var(--link-color) !important;
            text-decoration: underline;
            text-decoration-thickness: 1px;
            text-underline-offset: 3px;
        }

        /* --- MODAL DE PEGADO --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 2000; justify-content: center; align-items: center;
            backdrop-filter: blur(5px);
        }
        .modal-box {
            background: #222; width: 90%; max-width: 600px; height: 80%;
            border-radius: 12px; border: 1px solid #444; display: flex; flex-direction: column;
            padding: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }
        .modal-header { font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; color: white; display:flex; justify-content:space-between; align-items:center;}
        .modal-textarea {
            flex: 1; background: #111; border: 1px solid #333; color: white;
            padding: 15px; font-size: 1rem; border-radius: 8px; resize: none; outline: none;
            font-family: monospace;
        }
        .modal-textarea:focus { border-color: var(--accent-blue); }
        .modal-actions { display: flex; gap: 10px; margin-top: 15px; justify-content: flex-end; }
        .btn-modal { padding: 10px 20px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; color: white; }
        .btn-cancel { background: #444; }
        .btn-confirm { background: var(--accent-green); }

        /* --- EXTRAS --- */
        .reading-guide {
            position: fixed; top: 35%; left: 0; width: 100%; height: 0;
            border-top: 2px dashed rgba(255, 255, 255, 0.15); pointer-events: none; z-index: 500;
        }
        .reading-guide::before { content: "‚ñ∂"; position: absolute; left: 5px; top: -10px; color: var(--accent-green); opacity: 0.5;}

        #status-overlay {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 100px; height: 100px; color: rgba(255,255,255,0.8); pointer-events: none; z-index: 2000; opacity: 0; transition: opacity 0.3s;
        }
        #status-overlay svg { width: 100%; height: 100%; }

        @media (max-width: 400px) { .logo span { display: none; } .control-bar { gap: 5px; } }
    </style>
</head>
<body>

    <div style="display: none;">
        <svg id="icon-play" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        <svg id="icon-pause" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
        <svg id="icon-reset" viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
        <svg id="icon-save" viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg>
        <svg id="icon-folder" viewBox="0 0 24 24"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/></svg>
        <svg id="icon-paste" viewBox="0 0 24 24"><path d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/></svg>
        <svg id="icon-close" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
    </div>

    <div id="pasteModal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <span>Paste Text Script</span>
                <div onclick="closePasteModal()" style="cursor:pointer; opacity:0.7"><svg viewBox="0 0 24 24" style="width:20px;height:20px"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></div>
            </div>
            <textarea id="pasteInput" class="modal-textarea" placeholder="Paste your text here (Markdown supported)..."></textarea>
            <div class="modal-actions">
                <button class="btn-modal btn-cancel" onclick="closePasteModal()">Cancel</button>
                <button class="btn-modal btn-confirm" onclick="renderPaste()">Load Script</button>
            </div>
        </div>
    </div>

    <nav class="top-bar">
        <div class="logo">
            <svg viewBox="0 0 24 24" style="color:var(--accent-blue)"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/></svg>
            <span>Teleprompter</span>
        </div>
        <div class="header-actions">
            <button class="btn-header" onclick="openPasteModal()">
                <svg viewBox="0 0 24 24"><path d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/></svg>
                Paste
            </button>
            <button class="btn-header" onclick="document.getElementById('fileInput').click()">
                <svg viewBox="0 0 24 24"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/></svg>
                Upload
            </button>
        </div>
    </nav>

    <div id="status-overlay"></div>
    <div class="reading-guide"></div>

    <div id="teleprompter-area" onclick="handleAreaClick(event)">
        <div id="content" class="content-width markdown-body">
            <h1 style="text-align:center; color: #3498db;">Welcome to Teleprompter Pro</h1>
            
            <p>This application transforms your device into a professional teleprompter. It works completely offline and respects your privacy.</p>
            
            <hr>

            <h2>üöÄ How to Get Started</h2>
            <ul>
                <li><strong>Upload File:</strong> Tap the "Upload" button (top right) to load a <code>.txt</code> or <code>.md</code> file.</li>
                <li><strong>Paste Text:</strong> Tap "Paste" to insert text directly from your clipboard.</li>
            </ul>

            <h2>üéÆ Controls</h2>
            <ul>
                <li><strong>Play / Pause:</strong> Tap anywhere on the screen or press the Green Button below.</li>
                <li><strong>Speed:</strong> Use the Blue buttons <code>-</code> and <code>+</code> to adjust scrolling speed.</li>
                <li><strong>Font Size:</strong> Use the Orange buttons to change text size.</li>
                <li><strong>Reset:</strong> The Grey button rewinds to the start.</li>
                <li><strong>Save:</strong> The Purple button saves your current script and settings as a new HTML file.</li>
            </ul>

            <h2>‚ú® Pro Tips</h2>
            <ul>
                <li><strong>Links:</strong> Web links appear in <a href="#">Golden Yellow</a> for high visibility.</li>
                <li><strong>Keyboard:</strong> You can use the <code>Spacebar</code> to Play/Pause on desktop.</li>
                <li><strong>Markdown:</strong> You can use **bold**, *italics*, and headers to format your script.</li>
            </ul>

            <br><br><br>
        </div>
    </div>
    
    <input type="file" id="fileInput" accept=".md,.txt" style="display:none">

    <div class="control-bar">
        <button class="btn btn-start" id="btnToggle" onclick="toggleScroll(event)">
            <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </button>

        <button class="btn btn-reset" onclick="resetScroll()">
            <svg viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
        </button>

        <div class="control-group bg-blue">
            <button class="btn-mini" onclick="adjustSpeed(-1)">-</button>
            <span class="display-val" id="speedDisplay">4</span>
            <button class="btn-mini" onclick="adjustSpeed(1)">+</button>
        </div>

        <div class="control-group bg-orange">
            <button class="btn-mini" onclick="adjustSize(-2)">-</button>
            <span class="display-val">
                <svg viewBox="0 0 24 24" style="width:20px; height:20px; fill:white"><path d="M2.5 4v3h5v12h3V7h5V4h-13zm19 5h-9v3h3v7h3v-7h3V9z"/></svg>
            </span>
            <button class="btn-mini" onclick="adjustSize(2)">+</button>
        </div>

        <button class="btn btn-save" onclick="saveDocument()">
            <svg viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg>
        </button>
    </div>

    <script>
        // --- CONFIGURACI√ìN ---
        let isMobile = window.innerWidth < 768;
        let fontSize = isMobile ? 24 : 42; 
        let isScrolling = false;
        let scrollSpeed = 4; 
        let animationId;
        let lastTime = 0;
        let accumulator = 0;
        let loadedName = "script";

        const area = document.getElementById('teleprompter-area');
        const content = document.getElementById('content');
        const btnToggle = document.getElementById('btnToggle');
        const speedDisplay = document.getElementById('speedDisplay');
        const overlay = document.getElementById('status-overlay');
        const modal = document.getElementById('pasteModal');
        const pasteInput = document.getElementById('pasteInput');

        content.style.fontSize = fontSize + "px";
        speedDisplay.innerText = scrollSpeed;

        // SVG STRINGS
        const svgPlay = '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
        const svgPause = '<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
        const svgRotate = '<svg viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>';

        // --- CARGA DE ARCHIVO (UPLOAD) ---
        document.getElementById('fileInput').addEventListener('change', e => {
            const file = e.target.files[0];
            if(!file) return;
            loadedName = file.name.replace(/\.[^/.]+$/, "");
            const reader = new FileReader();
            reader.onload = evt => {
                loadMarkdown(evt.target.result);
            };
            reader.readAsText(file);
        });

        // --- FUNCIONES MODAL (PEGAR) ---
        function openPasteModal() {
            modal.style.display = 'flex';
            pasteInput.focus();
        }
        function closePasteModal() {
            modal.style.display = 'none';
        }
        function renderPaste() {
            const text = pasteInput.value;
            if (text.trim().length > 0) {
                loadedName = "pasted_script";
                loadMarkdown(text);
                closePasteModal();
            }
        }
        
        // --- L√ìGICA COM√öN DE CARGA ---
        function loadMarkdown(text) {
            try { 
                content.innerHTML = marked.parse(text); 
            } catch(err) { 
                content.innerText = text; 
            }
            area.scrollTop = 0;
            showFeedback(svgRotate);
            // Peque√±a pausa antes de auto-iniciar si el usuario quiere
            setTimeout(() => {
                // Opcional: Auto-start
            }, 1000);
        }

        // --- INTERACCI√ìN ---
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') { e.preventDefault(); toggleScroll(); }
        });
        function handleAreaClick(e) {
            if (e.target.closest('button') || e.target.closest('.modal-box') || e.target.tagName === 'A') return;
            toggleScroll();
        }

        // --- MOTOR SCROLL ---
        function step(timestamp) {
            if (!isScrolling) return;
            if (!lastTime) lastTime = timestamp;
            const delta = timestamp - lastTime;
            lastTime = timestamp;
            const pxPerSec = scrollSpeed * 3; 
            const move = (pxPerSec * delta) / 1000;
            accumulator += move;
            if (accumulator >= 1) {
                const pixelsToScroll = Math.floor(accumulator);
                area.scrollTop += pixelsToScroll;
                accumulator -= pixelsToScroll;
            }
            if (area.scrollTop + area.clientHeight >= area.scrollHeight - 1) stopScroll();
            else animationId = requestAnimationFrame(step);
        }

        function toggleScroll(e) { if(e) e.stopPropagation(); isScrolling ? stopScroll() : startScroll(); }
        function startScroll() { if(isScrolling) return; isScrolling = true; lastTime = 0; accumulator = 0; btnToggle.innerHTML = svgPause; btnToggle.classList.add('paused'); showFeedback(svgPlay); animationId = requestAnimationFrame(step); }
        function stopScroll() { isScrolling = false; cancelAnimationFrame(animationId); btnToggle.innerHTML = svgPlay; btnToggle.classList.remove('paused'); showFeedback(svgPause); }
        function resetScroll() { stopScroll(); area.scrollTop = 0; accumulator=0; showFeedback(svgRotate); }
        function adjustSpeed(delta) { let s = scrollSpeed + delta; if(s < 1) s = 1; if(s > 50) s = 50; scrollSpeed = s; speedDisplay.innerText = s; }
        function adjustSize(delta) { let s = fontSize + delta; if(s < 12) s = 12; if(s > 150) s = 150; fontSize = s; content.style.fontSize = fontSize + "px"; }
        function showFeedback(icon) { overlay.innerHTML = icon; overlay.style.opacity = "1"; overlay.style.transform = "translate(-50%, -50%) scale(1.2)"; setTimeout(() => { overlay.style.opacity = "0"; overlay.style.transform = "translate(-50%, -50%) scale(1)" }, 600); }

        // --- GUARDAR DOCUMENTO ---
        function saveDocument() {
            const styles = document.querySelector('style').innerHTML;
            // Guardamos el contenido HTML actual (que puede ser el manual o el texto del usuario)
            const contentHTML = content.innerHTML; 
            
            // Reconstruimos el archivo HTML completo
            // Nota: Se guarda sin el manual por defecto si el usuario ya carg√≥ algo.
            // Si el usuario guarda el manual, se guardar√° el manual.
            
            const fileContent = `<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover"><title>${loadedName}</title><script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"><\/script><style>${styles}</style></head><body>
            
            <div id="pasteModal" class="modal-overlay"><div class="modal-box"><div class="modal-header"><span>Paste Text Script</span><div onclick="closePasteModal()" style="cursor:pointer; opacity:0.7"><svg viewBox="0 0 24 24" style="width:20px;height:20px"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></div></div><textarea id="pasteInput" class="modal-textarea" placeholder="Paste your text here..."></textarea><div class="modal-actions"><button class="btn-modal btn-cancel" onclick="closePasteModal()">Cancel</button><button class="btn-modal btn-confirm" onclick="renderPaste()">Load Script</button></div></div></div>

            <nav class="top-bar">
                <div class="logo"><svg viewBox="0 0 24 24" style="color:#3498db; width:24px; height:24px; fill:currentColor"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/></svg> <span>${loadedName}</span></div>
                <div class="header-actions">
                    <button class="btn-header" onclick="openPasteModal()"><svg viewBox="0 0 24 24" style="width:18px;height:18px;fill:white"><path d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/></svg> Paste</button>
                    <button class="btn-header" onclick="document.getElementById('fileInput').click()"><svg viewBox="0 0 24 24" style="width:18px;height:18px;fill:white"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/></svg> Upload</button>
                </div>
            </nav>

            <div id="status-overlay"></div><div class="reading-guide"></div>

            <div id="teleprompter-area" onclick="handleAreaClick(event)">
                <div id="content" class="content-width markdown-body" style="font-size: ${fontSize}px;">${contentHTML}</div>
            </div>
            
            <input type="file" id="fileInput" accept=".md,.txt" style="display:none">

            <div class="control-bar">
                <button class="btn btn-start" id="btnToggle" onclick="toggleScroll(event)">${svgPlay}</button>
                <button class="btn btn-reset" onclick="resetScroll()"><svg viewBox="0 0 24 24" style="width:24px;height:24px;fill:white"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg></button>
                <div class="control-group bg-blue"><button class="btn-mini" onclick="adjustSpeed(-1)">-</button><span class="display-val" id="speedDisplay" style="color:white">${scrollSpeed}</span><button class="btn-mini" onclick="adjustSpeed(1)">+</button></div>
                <div class="control-group bg-orange"><button class="btn-mini" onclick="adjustSize(-2)">-</button><span class="display-val"><svg viewBox="0 0 24 24" style="width:20px; height:20px; fill:white"><path d="M2.5 4v3h5v12h3V7h5V4h-13zm19 5h-9v3h3v7h3v-7h3V9z"/></svg></span><button class="btn-mini" onclick="adjustSize(2)">+</button></div>
                <button class="btn btn-save" onclick="saveDocument()"><svg viewBox="0 0 24 24" style="width:24px;height:24px;fill:white"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg></button>
            </div>

            <script>
            let isMobile=window.innerWidth<768;let isScrolling=false;let scrollSpeed=${scrollSpeed};let fontSize=${fontSize};let animationId;let lastTime=0;let accumulator=0;let loadedName="${loadedName}";
            const area=document.getElementById('teleprompter-area');const content=document.getElementById('content');const btnToggle=document.getElementById('btnToggle');const speedDisplay=document.getElementById('speedDisplay');const overlay=document.getElementById('status-overlay');const modal=document.getElementById('pasteModal');const pasteInput=document.getElementById('pasteInput');
            const svgPlay = '${svgPlay}'; const svgPause = '${svgPause}'; const svgRotate = '${svgRotate}';
            
            document.getElementById('fileInput').addEventListener('change',e=>{const file=e.target.files[0];if(!file)return;loadedName=file.name.replace(/\.[^/.]+$/,"");const reader=new FileReader();reader.onload=evt=>{loadMarkdown(evt.target.result)};reader.readAsText(file)});
            function openPasteModal(){modal.style.display='flex';pasteInput.focus()}
            function closePasteModal(){modal.style.display='none'}
            function renderPaste(){const text=pasteInput.value;if(text.trim().length>0){loadedName="pasted_script";loadMarkdown(text);closePasteModal()}}
            function loadMarkdown(text){try{content.innerHTML=marked.parse(text)}catch(err){content.innerText=text}area.scrollTop=0;showFeedback(svgRotate)}
            document.addEventListener('keydown',(e)=>{if(e.code==='Space'){e.preventDefault();toggleScroll()}});
            function handleAreaClick(e){if(e.target.closest('button')||e.target.closest('.modal-box')||e.target.tagName==='A')return;toggleScroll()}
            function step(timestamp){if(!isScrolling)return;if(!lastTime)lastTime=timestamp;const delta=timestamp-lastTime;lastTime=timestamp;const pxPerSec=scrollSpeed*3;const move=(pxPerSec*delta)/1000;accumulator+=move;if(accumulator>=1){const pixelsToScroll=Math.floor(accumulator);area.scrollTop+=pixelsToScroll;accumulator-=pixelsToScroll}if(area.scrollTop+area.clientHeight>=area.scrollHeight-1)stopScroll();else animationId=requestAnimationFrame(step)}
            function toggleScroll(e){if(e)e.stopPropagation();isScrolling?stopScroll():startScroll()}
            function startScroll(){if(isScrolling)return;isScrolling=true;lastTime=0;accumulator=0;btnToggle.innerHTML=svgPause;btnToggle.classList.add('paused');showFeedback(svgPlay);animationId=requestAnimationFrame(step)}
            function stopScroll(){isScrolling=false;cancelAnimationFrame(animationId);btnToggle.innerHTML=svgPlay;btnToggle.classList.remove('paused');showFeedback(svgPause)}
            function resetScroll(){stopScroll();area.scrollTop=0;accumulator=0;showFeedback(svgRotate)}
            function adjustSpeed(delta){let s=scrollSpeed+delta;if(s<1)s=1;if(s>50)s=50;scrollSpeed=s;speedDisplay.innerText=s}
            function adjustSize(delta){let s=fontSize+delta;if(s<12)s=12;if(s>150)s=150;fontSize=s;content.style.fontSize=fontSize+"px"}
            function showFeedback(icon){overlay.innerHTML=icon;overlay.style.opacity="1";overlay.style.transform="translate(-50%, -50%) scale(1.2)";setTimeout(()=>{overlay.style.opacity="0";overlay.style.transform="translate(-50%, -50%) scale(1)"},600)}
            function saveDocument(){
                // Esta funci√≥n se sobreescribe a s√≠ misma en el archivo generado, pero es necesaria para que funcione en la primera carga
                const styles = document.querySelector('style').innerHTML;
                const contentHTML = content.innerHTML; 
                // ... (El c√≥digo de guardado es recursivo, igual al de arriba)
                // Para no duplicar c√≥digo en esta vista previa, la l√≥gica es id√©ntica a la variable fileContent de arriba.
                alert('Para guardar la versi√≥n final, usa el generador PHP o copia el c√≥digo completo.');
            }
            <\/script></body></html>`;
            
            const blob = new Blob([fileContent], {type: 'text/html'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = loadedName + "_v7.html";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>
</body>
</html>
