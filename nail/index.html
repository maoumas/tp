<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Thumbnail Generator Pro v3</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Bebas+Neue&family=Oswald:wght@700&family=Roboto:ital,wght@0,700;1,700&family=Montserrat:wght@800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --accent-color: #E62117; /* YouTube Red */
            --panel-bg: #1e1e1e;
            --input-bg: #2d2d2d;
            --border-color: #444;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            padding-bottom: 60px; /* Espacio para el footer */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- Header --- */
        .header-actions {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .lang-group { display: flex; gap: 5px; }
        
        .lang-btn {
            padding: 6px 10px;
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            cursor: pointer;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        .lang-btn.active { background: var(--accent-color); border-color: var(--accent-color); color: white; }

        h1 { margin: 0; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 1px; }

        /* --- Layout --- */
        .main-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 1100px;
            width: 100%;
            margin-bottom: 40px;
        }

        .panel {
            background-color: var(--panel-bg);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #333;
        }

        /* --- Preview Area --- */
        .preview-panel { width: 100%; position: relative; }
        
        .canvas-wrapper {
            width: 100%;
            position: relative;
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
            overflow: hidden;
            border-radius: 8px;
            border: 2px solid var(--border-color);
            background-color: #000;
            cursor: move; 
            touch-action: none; /* Mejor soporte táctil */
        }
        
        #previewCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        /* YouTube Fake Overlay */
        .yt-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: none;
        }
        .yt-time {
            position: absolute; bottom: 10px; right: 10px;
            background: rgba(0,0,0,0.8); color: white;
            padding: 3px 6px; border-radius: 4px; font-weight: bold; font-size: 12px;
        }

        /* --- Controls --- */
        .controls-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .control-section { display: flex; flex-direction: column; gap: 15px; }
        .control-group { display: flex; flex-direction: column; gap: 6px; }
        
        label { font-weight: 700; color: #aaa; font-size: 0.85rem; text-transform: uppercase; }
        
        input, select, textarea {
            width: 100%; padding: 10px; border-radius: 4px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg); color: white;
            box-sizing: border-box; font-family: inherit;
        }

        /* --- Single Line Font Controls (Mobile Optimized) --- */
        .font-controls {
            display: flex;
            gap: 5px;
            align-items: center;
            width: 100%;
            flex-wrap: nowrap; /* Fuerza una sola línea */
        }
        
        /* El select toma el espacio disponible, pero puede encogerse */
        .font-controls select {
            flex-grow: 1;
            flex-shrink: 1;
            min-width: 0; /* Permite encogerse más allá del contenido si es necesario */
            text-overflow: ellipsis;
        }

        /* Wrappers para los inputs de color para que sean compactos */
        .color-picker-wrapper {
            position: relative;
            width: 35px; /* Ancho fijo compacto */
            height: 38px;
            flex-shrink: 0; /* No encoger */
            border: 1px solid var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }
        input[type="color"] {
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            padding: 0; margin: 0;
            border: none;
            cursor: pointer;
        }

        .checkbox-btn {
            height: 38px; width: 38px; 
            flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
            background: var(--input-bg); border: 1px solid var(--border-color); 
            cursor: pointer; border-radius: 4px;
            font-style: italic; font-weight: bold; font-family: serif; color: #fff;
        }
        .checkbox-btn.active { background: var(--accent-color); border-color: var(--accent-color); }

        /* Sliders para Posición */
        .position-controls {
            display: flex;
            gap: 10px;
            margin-top: 5px;
            background: #252525;
            padding: 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            align-items: center;
        }
        .position-controls span { min-width: 40px; color: #888; }
        input[type=range] { width: 100%; cursor: pointer; accent-color: var(--accent-color); }

        /* Drop Zone */
        .drop-zone {
            border: 2px dashed var(--border-color); padding: 20px; text-align: center;
            border-radius: 6px; cursor: pointer; transition: 0.2s;
        }
        .drop-zone:hover { border-color: var(--accent-color); background: #252525; }

        /* Buttons */
        .btn {
            padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer;
            font-weight: bold; text-transform: uppercase; font-size: 0.9rem; transition: 0.2s;
        }
        .btn-primary { background: var(--accent-color); color: white; }
        .btn-secondary { background: #444; color: white; }
        .btn-success { background: #28a745; color: white; width: 100%; margin-top: 10px; padding: 15px;}
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }

        .toolbar { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }

        /* --- Footer --- */
        footer {
            margin-top: auto;
            width: 100%;
            text-align: center;
            padding: 20px;
            border-top: 1px solid #333;
            color: #666;
            font-size: 0.85rem;
        }
        footer a { color: var(--accent-color); text-decoration: none; font-weight: bold; }
        footer a:hover { text-decoration: underline; }
        .legal-note { font-size: 0.75rem; margin-top: 5px; opacity: 0.7; }
				        /* Estilos de la barra de herramientas */
        .toolbar { 
            display: flex; 
            gap: 10px; 
            margin-top: 10px; 
            width: 100%; /* Asegura que use todo el ancho */
        }

        /* --- AJUSTE PARA MÓVILES (Celulares) --- */
        @media (max-width: 600px) {
            .toolbar {
                gap: 5px; /* Reducir espacio entre botones */
            }

            .toolbar .btn {
                flex: 1; /* Obliga a los botones a estirarse y compartir el espacio equitativamente */
                font-size: 0.65rem; /* Texto más pequeño para que quepa */
                padding: 12px 2px; /* Reducir relleno lateral */
                white-space: nowrap; /* Evita que el texto del botón se parta en dos líneas */
                min-width: 0; /* Permite que el botón se encoja más si es necesario */
                text-overflow: clip; /* Corta el texto si es extremadamente largo (opcional) */
            }
        }


    </style>
</head>
<body>

    <div class="header-actions">
        <h1 data-translate="mainTitle">Thumbnail Generator Pro</h1>
        <div class="lang-group">
            <button class="lang-btn" onclick="setLanguage('es')">ES</button>
            <button class="lang-btn" onclick="setLanguage('en')">EN</button>
            <button class="lang-btn active" onclick="setLanguage('de')">DE</button>
        </div>
    </div>

    <div class="main-container">
        
        <div class="panel preview-panel">
            <div class="canvas-wrapper" id="canvasContainer">
                <canvas id="previewCanvas" width="1280" height="720"></canvas>
                <div class="yt-overlay" id="ytOverlay">
                    <div class="yt-time">12:45</div>
                </div>
            </div>
            <div class="toolbar">
                <button class="btn btn-secondary" id="togglePreviewBtn" data-translate="btnPreview">YouTube Preview</button>
                <button class="btn btn-secondary" onclick="resetBgTransform()" data-translate="btnResetImg">Reset Image</button>
                <button class="btn btn-primary" id="savePresetBtn" data-translate="btnSave">Save Settings</button>
            </div>
            <button id="downloadBtn" class="btn-success" data-translate="downloadBtn">DOWNLOAD FINAL IMAGE (HD)</button>
        </div>

        <div class="panel controls-panel">
            
            <div class="control-section">
                <div class="control-group">
                    <label data-translate="lblTemplate">Template</label>
                    <select id="templateSelect">
                        <option value="template1.png">Template 1 (Standard)</option>
                        <option value="template2.png">Template 2</option>
                        <option value="template3.png">Template 3</option>
                        <option value="none" data-translate="optNoTemplate">No Template (Image Only)</option>
                    </select>
                </div>

                <div class="control-group">
                    <label data-translate="lblTitle">Headline</label>
                    <input type="text" id="titleText" placeholder="THE TRUTH ABOUT..." value="">
                    
                    <div class="font-controls">
                        <select id="titleFont">
                            <option value="'Anton', sans-serif">Anton (Bold)</option>
                            <option value="'Bebas Neue', cursive">Bebas Neue</option>
                            <option value="'Oswald', sans-serif">Oswald</option>
                            <option value="'Montserrat', sans-serif">Montserrat</option>
                        </select>
                        <div class="color-picker-wrapper" title="Text Color">
                            <input type="color" id="titleColor" value="#FFFFFF">
                        </div>
                        <div class="color-picker-wrapper" title="Background Color">
                            <input type="color" id="titleBgColor" value="#CC0000">
                        </div>
                        <button class="checkbox-btn" id="titleItalicBtn" title="Italic">I</button>
                    </div>

                    <div class="position-controls">
                        <span title="Vertical Position">↕ Y:</span>
                        <input type="range" id="titleY" min="-300" max="300" value="0">
                        <span title="Size">Size:</span>
                        <input type="range" id="titleSize" min="10" max="200" value="90">
                    </div>
                </div>

                <div class="control-group">
                    <label data-translate="lblDesc">Subtitle</label>
                    <input type="text" id="descText" placeholder="Details here..." value="">
                    
                    <div class="font-controls">
                        <select id="descFont">
                            <option value="'Oswald', sans-serif">Oswald</option>
                            <option value="'Anton', sans-serif" selected>Anton</option>
                            <option value="'Roboto', sans-serif">Roboto</option>
                        </select>
                        <div class="color-picker-wrapper">
                            <input type="color" id="descColor" value="#FFFFFF">
                        </div>
                         <div class="color-picker-wrapper">
                            <input type="color" id="descBgColor" value="#000000">
                        </div>
                        <button class="checkbox-btn" id="descItalicBtn">I</button>
                    </div>

                    <div class="position-controls">
                        <span title="Vertical Position">↕ Y:</span>
                        <input type="range" id="descY" min="-300" max="300" value="0">
                        <span title="Size">Size:</span>
                        <input type="range" id="descSize" min="10" max="150" value="50">
                    </div>
                </div>
            </div>

            <div class="control-section">
                
                <div class="control-group">
                    <label data-translate="lblImage">Background Image</label>
                    <div class="drop-zone" id="dropZone">
                        <span data-translate="txtDrop">Drag & Drop Image Here<br>or Click to Upload</span>
                        <input type="file" id="bgUpload" accept="image/*" style="display:none">
                    </div>
                    <small style="color:#666; font-size: 0.75rem;">* Scroll to Zoom, Drag to Move</small>
                </div>

                <div style="border-top: 1px solid #444; margin: 10px 0;"></div>

                <div class="control-group">
                    <label>AI Prompt Generator (Grok)</label>
                    <input type="text" id="grokIdea" placeholder="e.g. Angry politician in rain..." data-translate-ph="phGrokIdea">
                    
                    <div style="display:flex; gap:10px; margin-top:5px;">
                        <select id="grokStyle">
                            <option value="photorealistic, dramatic lighting, 8k">Realistic/Dramatic</option>
                            <option value="cartoon, vibrant colors, bold lines">Cartoon/Vibrant</option>
                            <option value="black and white, noir, mysterious">Noir/B&W</option>
                        </select>
                        <button id="genPromptBtn" class="btn-primary" style="flex:1;" data-translate="btnGen">Generate & Open</button>
                    </div>
                    <textarea id="grokOutput" readonly style="height: 60px; margin-top:5px; font-size:0.8rem; color:#888;"></textarea>
                </div>

            </div>
        </div>
    </div>

    <footer>
        <div>
            Visit our YouTube Channel: 
            <a href="https://youtube.com/@translatedpressde" target="_blank">@translatedpressde</a>
        </div>
        <div class="legal-note">
            &copy; 2025 Mauricio Umana. All rights reserved. 
            <br>
            Development and source code protected. Unauthorized reproduction prohibited.
        </div>
    </footer>

    <script>
        // --- CONFIGURATION ---
        const canvas = document.getElementById('previewCanvas');
        const ctx = canvas.getContext('2d');
        
        // State Variables
        let state = {
            template: null,
            bgImage: null,
            bgX: 0,
            bgY: 0,
            bgScale: 1,
            isDragging: false,
            lastX: 0,
            lastY: 0,
            titleItalic: false,
            descItalic: false,
            templateName: 'template1.png'
        };

        // Base Configs (Coordinates). User adjustments will be added to these.
        const baseConfigs = {
            'template1.png': {
                title: { x: 640, y: 600, w: 1200, h: 120, align: 'center' },
                desc:  { x: 640, y: 480, w: 1000, h: 80,  align: 'center' }
            },
            'template2.png': {
                title: { x: 50, y: 620, w: 1180, h: 100, align: 'left' },
                desc:  { x: 50, y: 520, w: 1180, h: 80,  align: 'left' }
            },
            'template3.png': {
                title: { x: 640, y: 360, w: 1000, h: 150, align: 'center' },
                desc:  { x: 640, y: 500, w: 800, h: 80, align: 'center' }
            },
            'none': {
                title: { x: 640, y: 600, w: 1200, h: 150, align: 'center' },
                desc:  { x: 640, y: 450, w: 1200, h: 80, align: 'center' }
            }
        };

        // --- TRANSLATIONS (German Default) ---
        const translations = {
            de: {
                mainTitle: "Thumbnail Generator Pro",
                lblTemplate: "Vorlage wählen",
                optNoTemplate: "Keine Vorlage (Nur Bild)",
                lblTitle: "Schlagzeile",
                lblDesc: "Untertitel / Beschreibung",
                lblImage: "Hintergrundbild",
                txtDrop: "Bild hier ablegen oder klicken",
                phGrokIdea: "Idee (z.B. Schockierter Mann...)",
                btnGen: "Generieren & Grok öffnen",
                btnPreview: "YouTube Vorschau",
                btnResetImg: "Bild zurücksetzen",
                btnSave: "Einstellungen speichern",
                downloadBtn: "THUMBNAIL HERUNTERLADEN (HD)",
                promptPrefix: "Erstelle ein YouTube Thumbnail Hintergrundbild. Seitenverhältnis 16:9. Keine Schrift. Stil: "
            },
            en: {
                mainTitle: "Thumbnail Generator Pro",
                lblTemplate: "Select Template",
                optNoTemplate: "No Template (Image Only)",
                lblTitle: "Headline",
                lblDesc: "Subtitle",
                lblImage: "Background Image",
                txtDrop: "Drag & Drop or Click",
                phGrokIdea: "Idea (e.g. Shocked man...)",
                btnGen: "Generate & Open Grok",
                btnPreview: "YouTube Preview",
                btnResetImg: "Reset Image",
                btnSave: "Save Settings",
                downloadBtn: "DOWNLOAD THUMBNAIL",
                promptPrefix: "Create a YouTube thumbnail background image. 16:9 aspect ratio. No text. Style: "
            },
            es: {
                mainTitle: "Generador de Miniaturas",
                lblTemplate: "Plantilla",
                optNoTemplate: "Sin Plantilla (Solo Imagen)",
                lblTitle: "Título Principal",
                lblDesc: "Subtítulo",
                lblImage: "Imagen de Fondo",
                txtDrop: "Arrastra o Clic aquí",
                phGrokIdea: "Idea (ej. Hombre sorprendido...)",
                btnGen: "Generar y Abrir Grok",
                btnPreview: "Vista Previa YT",
                btnResetImg: "Resetear Imagen",
                btnSave: "Guardar Ajustes",
                downloadBtn: "DESCARGAR IMAGEN",
                promptPrefix: "Crea una imagen de fondo para miniatura de YouTube. Ratio 16:9. Sin texto. Estilo: "
            }
        };
        let currentLang = 'de';

        // --- CORE DRAWING FUNCTION ---
        function draw() {
            // 1. Clear & Black Background
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. Draw User Background Image (with Pan/Zoom)
            if (state.bgImage) {
                ctx.save();
                ctx.translate(canvas.width/2 + state.bgX, canvas.height/2 + state.bgY);
                ctx.scale(state.bgScale, state.bgScale);
                ctx.drawImage(state.bgImage, -state.bgImage.width/2, -state.bgImage.height/2);
                ctx.restore();
            }

            // 3. Draw Template Overlay (skip if 'none')
            if (state.template && state.templateName !== 'none') {
                ctx.drawImage(state.template, 0, 0, canvas.width, canvas.height);
            }

            // 4. Draw Text with Dynamic Adjustments
            const base = baseConfigs[state.templateName] || baseConfigs['none'];
            
            // Get user adjustments (Y offset and Size)
            const titleYOffset = parseInt(document.getElementById('titleY').value);
            const titleSize = parseInt(document.getElementById('titleSize').value);
            
            const descYOffset = parseInt(document.getElementById('descY').value);
            const descSize = parseInt(document.getElementById('descSize').value);

            // Create adjusted boxes
            const titleBox = { ...base.title, y: base.title.y + titleYOffset, h: titleSize * 1.5 }; 
            const descBox = { ...base.desc, y: base.desc.y + descYOffset, h: descSize * 1.5 };

            drawRichText(
                document.getElementById('titleText').value.toUpperCase(),
                titleBox,
                titleSize,
                document.getElementById('titleFont').value,
                document.getElementById('titleColor').value,
                document.getElementById('titleBgColor').value,
                state.titleItalic
            );

            drawRichText(
                document.getElementById('descText').value,
                descBox,
                descSize,
                document.getElementById('descFont').value,
                document.getElementById('descColor').value,
                document.getElementById('descBgColor').value,
                state.descItalic
            );
        }

        // --- ADVANCED TEXT RENDERER ---
        function drawRichText(text, box, fontSize, font, color, bgColor, italic) {
            if (!text) return;
            
            const style = italic ? 'italic bold' : 'bold';
            ctx.font = `${style} ${fontSize}px ${font}`;
            ctx.textAlign = box.align;
            ctx.textBaseline = 'top';

            // Wrap Text
            const lines = getLines(ctx, text, box.w);
            const lineHeight = fontSize * 1.2;
            const totalH = lines.length * lineHeight;
            
            // Vertical Align Center of the Box
            let y = box.y - (totalH / 2); // Center around the Y point set by slider

            lines.forEach(line => {
                const metrics = ctx.measureText(line);
                const textW = metrics.width;
                const padding = fontSize * 0.2;
                
                // Calculate Background Box X
                let bgX = box.x;
                if (box.align === 'center') bgX = box.x - textW/2;
                if (box.align === 'right') bgX = box.x - textW;

                // Draw Background
                if (bgColor !== '#000000' && bgColor !== '#ffffff' && bgColor !== 'transparent') {
                     ctx.fillStyle = bgColor;
                     ctx.fillRect(bgX - padding, y, textW + (padding*2), lineHeight);
                } else if (bgColor === '#000000' || bgColor === '#ffffff') {
                     // Check if user actively wants these common colors
                     ctx.fillStyle = bgColor;
                     ctx.fillRect(bgX - padding, y, textW + (padding*2), lineHeight);
                }

                // Draw Text
                ctx.fillStyle = color;
                ctx.shadowColor = "rgba(0,0,0,0.5)";
                ctx.shadowBlur = 4;
                ctx.fillText(line, box.x, y + (lineHeight - fontSize)/2);
                ctx.shadowBlur = 0;

                y += lineHeight;
            });
        }

        function getLines(ctx, text, maxWidth) {
            var words = text.split(" ");
            var lines = [];
            var currentLine = words[0];

            for (var i = 1; i < words.length; i++) {
                var word = words[i];
                var width = ctx.measureText(currentLine + " " + word).width;
                if (width < maxWidth) {
                    currentLine += " " + word;
                } else {
                    lines.push(currentLine);
                    currentLine = word;
                }
            }
            lines.push(currentLine);
            return lines;
        }

        // --- IMAGE MANIPULATION LOGIC ---
        function resetBgTransform() {
            state.bgX = 0; state.bgY = 0; state.bgScale = 1;
            draw();
        }

        // Mouse/Touch Events for Canvas
        const canvasContainer = document.getElementById('canvasContainer');
        
        canvas.addEventListener('mousedown', (e) => {
            state.isDragging = true; state.lastX = e.clientX; state.lastY = e.clientY;
        });
        window.addEventListener('mouseup', () => { state.isDragging = false; });
        window.addEventListener('mousemove', (e) => {
            if (!state.isDragging || !state.bgImage) return;
            const dx = e.clientX - state.lastX;
            const dy = e.clientY - state.lastY;
            state.bgX += dx; state.bgY += dy;
            state.lastX = e.clientX; state.lastY = e.clientY;
            draw();
        });
        // Wheel Zoom
        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            if (!state.bgImage) return;
            const scaleFactor = 0.05;
            if (e.deltaY < 0) state.bgScale += scaleFactor;
            else state.bgScale = Math.max(0.1, state.bgScale - scaleFactor);
            draw();
        }, { passive: false });


        // --- UI & EVENTS ---
        
        // Template
        document.getElementById('templateSelect').addEventListener('change', (e) => {
            state.templateName = e.target.value;
            if (state.templateName === 'none') {
                state.template = null;
                draw();
            } else {
                const img = new Image();
                img.onload = () => { state.template = img; draw(); };
                img.src = state.templateName;
            }
        });

        // Image Drop
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('bgUpload');
        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.style.borderColor = '#fff'; });
        dropZone.addEventListener('dragleave', () => { dropZone.style.borderColor = '#444'; });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault(); dropZone.style.borderColor = '#444';
            handleFile(e.dataTransfer.files[0]);
        });
        fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));

        function handleFile(file) {
            if (!file || !file.type.startsWith('image/')) return;
            const reader = new FileReader();
            reader.onload = (evt) => {
                const img = new Image();
                img.onload = () => { 
                    state.bgImage = img; 
                    const scale = Math.max(canvas.width / img.width, canvas.height / img.height);
                    state.bgScale = scale;
                    draw(); 
                };
                img.src = evt.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Live Inputs (Text, Font, Colors, Sliders)
        const inputs = [
            'titleText', 'descText', 'titleFont', 'descFont', 
            'titleColor', 'descColor', 'titleBgColor', 'descBgColor',
            'titleY', 'titleSize', 'descY', 'descSize'
        ];
        inputs.forEach(id => {
            document.getElementById(id).addEventListener('input', draw);
        });

        // Italics
        document.getElementById('titleItalicBtn').addEventListener('click', function() {
            state.titleItalic = !state.titleItalic; this.classList.toggle('active'); draw();
        });
        document.getElementById('descItalicBtn').addEventListener('click', function() {
            state.descItalic = !state.descItalic; this.classList.toggle('active'); draw();
        });

        // Grok
        document.getElementById('genPromptBtn').addEventListener('click', () => {
            const idea = document.getElementById('grokIdea').value;
            const style = document.getElementById('grokStyle').value;
            const prefix = translations[currentLang].promptPrefix;
            const fullPrompt = `${prefix} ${style}. Details: ${idea}`;
            document.getElementById('grokOutput').value = fullPrompt;
            navigator.clipboard.writeText(fullPrompt);
            window.open('https://grok.com', '_blank');
        });

        // Preview
        document.getElementById('togglePreviewBtn').addEventListener('click', () => {
            const overlay = document.getElementById('ytOverlay');
            overlay.style.display = (overlay.style.display === 'block') ? 'none' : 'block';
        });

        // Download
        document.getElementById('downloadBtn').addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'thumbnail_pro.png';
            link.href = canvas.toDataURL('image/png', 1.0);
            link.click();
        });

        // Language
        function setLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`.lang-btn[onclick="setLanguage('${lang}')"]`).classList.add('active');
            
            document.querySelectorAll('[data-translate]').forEach(el => {
                if(translations[lang][el.dataset.translate]) {
                    el.textContent = translations[lang][el.dataset.translate];
                }
            });
            document.querySelectorAll('[data-translate-ph]').forEach(el => {
                 if(translations[lang][el.dataset.translatePh]) {
                    el.placeholder = translations[lang][el.dataset.translatePh];
                 }
            });
        }

        // Save
        document.getElementById('savePresetBtn').addEventListener('click', () => {
            const settings = {
                titleFont: document.getElementById('titleFont').value,
                titleColor: document.getElementById('titleColor').value,
                titleBgColor: document.getElementById('titleBgColor').value,
            };
            localStorage.setItem('thumbGenSettings', JSON.stringify(settings));
            alert('Settings Saved / Einstellungen gespeichert');
        });
        
        // Init
        window.onload = () => {
            setLanguage('de'); // Default DE
            // Load Template 1
            const img = new Image();
            img.onload = () => { state.template = img; draw(); };
            img.src = 'template1.png';
            
            // Load saved
            const saved = localStorage.getItem('thumbGenSettings');
            if(saved) {
                const s = JSON.parse(saved);
                if(s.titleFont) document.getElementById('titleFont').value = s.titleFont;
                if(s.titleColor) document.getElementById('titleColor').value = s.titleColor;
                if(s.titleBgColor) document.getElementById('titleBgColor').value = s.titleBgColor;
            }
        };

    </script>
</body>
</html>
