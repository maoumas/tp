<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pascaline Simulator - For Arti</title>

  <meta property="og:title" content="The Pascaline: Stress Calculator">
  <meta property="og:description" content="A 17th-century tool to calculate 21st-century problems.">
  <meta property="og:image" content="../img/pascaline.png">
  <meta property="og:type" content="website">

  <style>
    :root {
      --bg-page: #d9cfc0;
      --panel-bg: #f4eee4;
      --plate-bg: #c9b595;
      --wheel-face: radial-gradient(circle at center, #dcc9a8 0%, #bfa883 70%, #a5916b 100%);
      --border-dark: #7b664f;
      --text-dark: #2e2415;
      --acc-win-bg: #faf5ee;
      --acc-border: #9f8e76;
      --button-bg: #7b664f;
      --button-hover: #8c7a62;
      --button-active: #bfa883; 
      --overlay-comp: rgba(255,255,255,0.7);
      --lever-color: #7b664f;
      --link-color: #5a4635;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      background: var(--bg-page);
      font-family: 'Georgia', serif;
      color: var(--text-dark);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    
    /* Wrapper to center content and allow scrolling */
    .container {
      width: 100%;
      max-width: 600px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* --- Machine Styles --- */
    #machine {
      background: var(--panel-bg);
      border: 3px solid var(--border-dark);
      border-radius: 12px;
      padding: 16px;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.2), 0 4px 12px rgba(0,0,0,0.3);
      width: 100%;
      margin-bottom: 30px;
      position: relative;
    }
    #plate {
      background: var(--plate-bg);
      border: 2px solid var(--border-dark);
      border-radius: 8px;
      padding: 16px;
      position: relative;
      overflow: hidden;
    }
    .accumulator {
      display: flex;
      justify-content: center;
      margin-bottom: 14px;
      position: relative;
      height: 60px;
    }
    .acc-window {
      width: 45px;
      height: 60px;
      margin: 0 3px;
      background: var(--acc-win-bg);
      border: 2px inset var(--acc-border);
      border-radius: 4px;
      text-align: center;
      line-height: 60px;
      font-size: 1.5em;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
      color: var(--text-dark);
      font-family: "Courier New", monospace;
    }
    #compBar {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: var(--overlay-comp);
      display: none;
      border-radius: 4px;
      z-index: 2;
      pointer-events: none;
    }
    #compBar span {
      position: absolute;
      right: 6px;
      bottom: 6px;
      font-size: 0.85em;
      color: #333;
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(255,255,255,0.8);
    }
    .input-wheels {
      display: flex;
      justify-content: center;
      flex-wrap: nowrap; 
      overflow-x: auto; 
      margin-bottom: 10px;
      padding-bottom: 5px;
    }
    .wheel {
      position: relative;
      width: 50px;
      height: 50px;
      margin: 0 4px 10px;
      background: var(--wheel-face);
      border: 3px solid var(--border-dark);
      border-radius: 50%;
      box-shadow: inset 0 1px 4px rgba(0,0,0,0.3), 0 2px 4px rgba(0,0,0,0.3);
      cursor: pointer;
      user-select: none;
      overflow: hidden;
      transition: transform 0.25s ease-out;
      flex-shrink: 0;
    }
    .wheel .digits {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      transition: transform 0.2s ease-out;
    }
    .wheel .digits div {
      height: 50px;
      line-height: 50px;
      text-align: center;
      font-size: 1.6em;
      color: var(--text-dark);
      font-family: "Courier New", monospace;
    }
    .wheel::before {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      border-radius: 50%;
      pointer-events: none;
      background:
        radial-gradient(circle at center, transparent 50%, rgba(0,0,0,0.2) 52%),
        repeating-conic-gradient(
          transparent 0deg 40deg,
          rgba(0,0,0,0.15) 40deg 44deg
        );
      background-blend-mode: multiply;
    }
    .controls {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 12px 0 18px;
    }
    .controls button {
      background: var(--button-bg);
      color: var(--acc-win-bg);
      border: none;
      padding: 10px 16px;
      font-size: 1em;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      transition: background 0.2s;
    }
    .controls button:hover {
      background: var(--button-hover);
    }
    .controls button.active-mode {
      background: var(--button-active);
      color: var(--text-dark);
      font-weight: bold;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
    }

    #lever-container {
      position: absolute;
      top: 10px; left: 10px;
      width: 60px; height: 60px;
      pointer-events: none;
      z-index: 5;
    }
    #lever {
      transform-origin: 30px 30px;
      transition: transform 0.15s ease-out;
    }
    .lever-activate { transform: rotate(-30deg); }

    /* --- Text & Instruction Styles --- */
    .lang-bar {
      margin-bottom: 15px;
      display: flex;
      gap: 15px;
      font-weight: bold;
      font-family: sans-serif;
      font-size: 0.9em;
    }
    .lang-opt {
      cursor: pointer;
      border-bottom: 2px solid transparent;
      padding-bottom: 2px;
      color: var(--link-color);
      opacity: 0.6;
    }
    .lang-opt:hover { opacity: 1; }
    .lang-opt.active {
      border-color: var(--border-dark);
      opacity: 1;
    }

    .content-panel {
      background: #f7f2e8;
      padding: 25px;
      border-top: 1px solid var(--border-dark);
      border-bottom: 1px solid var(--border-dark);
      color: var(--text-dark);
      line-height: 1.6;
      width: 100%;
    }
    .content-panel h2 {
      margin-top: 0;
      border-bottom: 1px solid #ccc;
      padding-bottom: 10px;
    }
    .content-panel h3 {
      margin-top: 25px;
      font-size: 1.1em;
      font-style: italic;
    }
    .math-block {
      background: #eae0d0;
      padding: 10px;
      border-left: 4px solid var(--border-dark);
      font-family: "Courier New", monospace;
      margin: 15px 0;
    }

    /* --- Footer Links --- */
    .footer-links {
      margin-top: 40px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      width: 100%;
      padding-bottom: 40px;
    }
    .footer-btn {
      text-decoration: none;
      background: #333;
      color: #fff;
      padding: 12px 20px;
      border-radius: 4px;
      font-family: sans-serif;
      font-size: 0.9em;
      transition: background 0.3s;
    }
    .footer-btn:hover { background: #555; }
  </style>
</head>
<body>

<div class="container">

  <div id="machine">
    <div id="plate">
      <div id="lever-container">
        <svg id="lever" width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">
          <circle cx="30" cy="30" r="6" fill="var(--lever-color)" />
          <rect x="28" y="10" width="4" height="30" fill="var(--lever-color)" />
          <polygon points="28,40 32,40 30,48" fill="var(--lever-color)" />
        </svg>
      </div>

      <div class="accumulator" id="accumulator">
        <div id="compBar"><span>COMPLEMENT / SUBTRACT</span></div>
      </div>
      <div class="input-wheels" id="inputWheels"></div>
      
      <div class="controls">
        <button id="btnAdd">Enter / Add</button>
        <button id="btnComp">Subtraction Mode</button>
        <button id="btnClear">Clear</button>
      </div>
    </div>
  </div>

  <div class="lang-bar">
    <span class="lang-opt active" onclick="setLang('en')">EN</span>
    <span class="lang-opt" onclick="setLang('es')">ES</span>
    <span class="lang-opt" onclick="setLang('de')">DE</span>
  </div>

  <div class="content-panel">
    <h2 id="txt-title">To my friend Arti: The Stress Calculator</h2>
    
    <p id="txt-arti">
      Listen, Arti. I know modern life is chaos. But before you panic, calculate. Use this machine in times of high stress. Add 50 units of "Deadline Pressure". Subtract 20 units of "Coffee Break". If the result overflows, go sleep. If the result is negative, you are dead. Relax, spin the wheels, and remember that numbers—unlike people—always make sense.
    </p>

    <h3 id="txt-hist-title">Historical Context</h3>
    <p id="txt-hist">
      Blaise Pascal invented this mechanical calculator (the Pascaline) in 1642, initially to help his father with tax calculations. It was the first functional mechanical calculator in history. While it excelled at addition, subtraction was a clumsy nightmare—until now.
    </p>

    <h3 id="txt-sub-title">The Art of Subtraction (100 - 10)</h3>
    <p id="txt-sub-1">
      The Pascaline wheels could only rotate one way (addition). To subtract, we use the <b>Method of Complements</b>.
    </p>
    <div class="math-block" id="txt-math">
      Problem: 100 - 10 = ?<br><br>
      1. We don't subtract 10.<br>
      2. We find the complement of 10 relative to the machine's capacity.<br>
      3. Complement of 10 is 999990.<br>
      4. We ADD: 100 + 999990 = 1000090.<br>
      5. The '1' on the far left overflows and is discarded (the "End Carry").<br>
      6. Remaining Result: 90.
    </div>
    <p id="txt-sub-2">
      <b>How to use it here:</b><br>
      1. Enter 100 and press Add.<br>
      2. Set wheels to 10.<br>
      3. Press "Subtraction Mode" (this calculates the complement visually).<br>
      4. Press Add. Toggle mode off to see the result (90).
    </p>
  </div>

  <div class="footer-links">
    <a href="https://lpascal.com/gen.htnl" class="footer-btn" id="btn-tele">Teleprompter Generator</a>
    <a href="https://lpascal.com/prompt/index.html" class="footer-btn" id="btn-video">Video Prompt Generator</a>
  </div>

  <div id="footer-container"></div>

</div>

<script>
  /* --- LANGUAGE DATA --- */
  const translations = {
    en: {
      btnAdd: "Enter / Add",
      btnComp: "Subtraction Mode",
      btnClear: "Clear",
      title: "To my friend Arti: The Stress Calculator",
      arti: "Listen, Arti. I know modern life is chaos. But before you panic, calculate. Use this machine in times of high stress. Add 50 units of \"Deadline Pressure\". Subtract 20 units of \"Coffee Break\". If the result overflows, go sleep. If the result is negative, you are dead. Relax, spin the wheels, and remember that numbers—unlike people—always make sense.",
      histTitle: "Historical Context",
      hist: "Blaise Pascal invented this mechanical calculator (the Pascaline) in 1642, initially to help his father with tax calculations. It was the first functional mechanical calculator in history. While it excelled at addition, subtraction was a clumsy nightmare—until now.",
      subTitle: "The Art of Subtraction (100 - 10)",
      sub1: "The Pascaline wheels could only rotate one way (addition). To subtract, we use the <b>Method of Complements</b>.",
      math: "Problem: 100 - 10 = ?<br><br>1. We don't subtract 10.<br>2. We find the complement of 10 relative to the machine's capacity.<br>3. Complement of 10 is 999990.<br>4. We ADD: 100 + 999990 = 1000090.<br>5. The '1' on the far left overflows and is discarded (the \"End Carry\").<br>6. Remaining Result: 90.",
      sub2: "<b>How to use it here:</b><br>1. Enter 100 and press Add.<br>2. Set wheels to 10.<br>3. Press \"Subtraction Mode\" (this calculates the complement visually).<br>4. Press Add. Toggle mode off to see the result (90).",
      btnTele: "Teleprompter Generator",
      btnVideo: "Video Prompt Generator"
    },
    es: {
      btnAdd: "Ingresar / Sumar",
      btnComp: "Modo Resta",
      btnClear: "Borrar",
      title: "Para mi amigo Arti: Calculadora de Estrés",
      arti: "Escucha, Arti. Sé que la vida moderna es un caos. Pero antes de entrar en pánico, calcula. Usa esta máquina en momentos de alto estrés. Suma 50 unidades de \"Presión de entrega\". Resta 20 unidades de \"Café\". Si el resultado se desborda, ve a dormir. Si es negativo, estás muerto. Relájate, gira las ruedas y recuerda que los números —a diferencia de las personas— siempre tienen sentido.",
      histTitle: "Contexto Histórico",
      hist: "Blaise Pascal inventó esta calculadora mecánica (la Pascalina) en 1642, inicialmente para ayudar a su padre con los cálculos de impuestos. Fue la primera calculadora mecánica funcional de la historia. Aunque era excelente sumando, la resta era una pesadilla torpe... hasta ahora.",
      subTitle: "El Arte de la Resta (100 - 10)",
      sub1: "Las ruedas de la Pascalina solo giraban en un sentido (suma). Para restar, usamos el <b>Método del Complemento</b>.",
      math: "Problema: 100 - 10 = ?<br><br>1. No restamos 10.<br>2. Buscacmos el complemento de 10 relativo a la capacidad de la máquina.<br>3. El complemento de 10 es 999990.<br>4. SUMAMOS: 100 + 999990 = 1000090.<br>5. El '1' a la extrema izquierda se desborda y se descarta (el \"Acarreo Final\").<br>6. Resultado restante: 90.",
      sub2: "<b>Cómo usarla aquí:</b><br>1. Ingresa 100 y presiona Sumar.<br>2. Pon las ruedas en 10.<br>3. Presiona \"Modo Resta\" (esto calcula el complemento visualmente).<br>4. Presiona Sumar. Apaga el modo para ver el resultado (90).",
      btnTele: "Generador de Teleprompter",
      btnVideo: "Generador de Video Prompt"
    },
    de: {
      btnAdd: "Eingabe / Addieren",
      btnComp: "Subtraktionsmodus",
      btnClear: "Löschen",
      title: "An meinen Freund Arti: Der Stressrechner",
      arti: "Hör zu, Arti. Ich weiß, das moderne Leben ist Chaos. Aber bevor du in Panik gerätst, rechne. Nutze diese Maschine in Zeiten hohen Stresses. Addiere 50 Einheiten „Termindruck“. Subtrahiere 20 Einheiten „Kaffeepause“. Wenn das Ergebnis überläuft, geh schlafen. Wenn es negativ ist, bist du tot. Entspann dich, dreh die Räder und denk daran: Zahlen ergeben – im Gegensatz zu Menschen – immer einen Sinn.",
      histTitle: "Historischer Kontext",
      hist: "Blaise Pascal erfand diesen mechanischen Rechner (die Pascaline) im Jahr 1642, ursprünglich um seinem Vater bei Steuerberechnungen zu helfen. Es war der erste funktionierende mechanische Rechner der Geschichte. Während sie beim Addieren hervorragend war, war das Subtrahieren ein Albtraum – bis jetzt.",
      subTitle: "Die Kunst der Subtraktion (100 - 10)",
      sub1: "Die Räder der Pascaline konnten sich nur in eine Richtung drehen (Addition). Zum Subtrahieren nutzen wir die <b>Komplementmethode</b>.",
      math: "Problem: 100 - 10 = ?<br><br>1. Wir subtrahieren nicht 10.<br>2. Wir finden das Komplement von 10 relativ zur Kapazität der Maschine.<br>3. Komplement von 10 ist 999990.<br>4. Wir ADDIEREN: 100 + 999990 = 1000090.<br>5. Die '1' ganz links läuft über und wird verworfen.<br>6. Verbleibendes Ergebnis: 90.",
      sub2: "<b>Verwendung hier:</b><br>1. Gib 100 ein und drücke Addieren.<br>2. Stelle Räder auf 10.<br>3. Drücke „Subtraktionsmodus“ (berechnet das Komplement).<br>4. Drücke Addieren. Modus ausschalten für Ergebnis (90).",
      btnTele: "Teleprompter Generator",
      btnVideo: "Video Prompt Generator"
    }
  };

  function setLang(lang) {
    // Buttons
    document.getElementById("btnAdd").innerText = translations[lang].btnAdd;
    document.getElementById("btnComp").innerText = translations[lang].btnComp;
    document.getElementById("btnClear").innerText = translations[lang].btnClear;
    document.getElementById("btn-tele").innerText = translations[lang].btnTele;
    document.getElementById("btn-video").innerText = translations[lang].btnVideo;

    // Content
    document.getElementById("txt-title").innerText = translations[lang].title;
    document.getElementById("txt-arti").innerText = translations[lang].arti;
    document.getElementById("txt-hist-title").innerText = translations[lang].histTitle;
    document.getElementById("txt-hist").innerText = translations[lang].hist;
    document.getElementById("txt-sub-title").innerText = translations[lang].subTitle;
    document.getElementById("txt-sub-1").innerHTML = translations[lang].sub1;
    document.getElementById("txt-math").innerHTML = translations[lang].math;
    document.getElementById("txt-sub-2").innerHTML = translations[lang].sub2;

    // Styling Active State
    document.querySelectorAll(".lang-opt").forEach(el => el.classList.remove("active"));
    const activeBtn = document.querySelector(`.lang-opt[onclick="setLang('${lang}')"]`);
    if(activeBtn) activeBtn.classList.add("active");
  }

  /* --- PASCALINE LOGIC --- */
  const NUM = 6;
  let accumulator = new Array(NUM).fill(0);
  let input = new Array(NUM).fill(0);
  let isSubtractionMode = false;

  const accContainer = document.getElementById("accumulator");
  const inputWheelsContainer = document.getElementById("inputWheels");
  const compBar = document.getElementById("compBar");
  const lever = document.getElementById("lever");
  
  const btnAdd = document.getElementById("btnAdd");
  const btnComp = document.getElementById("btnComp");
  const btnClear = document.getElementById("btnClear");

  function initAccumulator() {
    for (let i = 0; i < NUM; i++) {
      const w = document.createElement("div");
      w.className = "acc-window";
      w.textContent = "0";
      accContainer.appendChild(w);
    }
  }
  
  const wheelElems = [];
  function initWheels() {
    for (let i = 0; i < NUM; i++) {
      const w = document.createElement("div");
      w.className = "wheel";
      const digits = document.createElement("div");
      digits.className = "digits";
      for (let d = 0; d < 10; d++) {
        const dd = document.createElement("div");
        dd.textContent = d;
        digits.appendChild(dd);
      }
      w.appendChild(digits);
      inputWheelsContainer.appendChild(w);
      wheelElems.push({ wheel: w, digits: digits });
      w.addEventListener("click", () => rotateInputWheel(i));
    }
  }

  let audioCtx;
  function playClick(freq = 220, dur = 0.05) {
    if (!window.AudioContext && !window.webkitAudioContext) return;
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = "square";
    osc.frequency.value = freq;
    gain.gain.value = 0.1;
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + dur);
  }

  function animateLever() {
    lever.classList.add("lever-activate");
    setTimeout(() => { lever.classList.remove("lever-activate"); }, 200);
  }

  function rotateInputWheel(idx) {
    input[idx] = (input[idx] + 1) % 10;
    const deg = input[idx] * (360 / 10);
    wheelElems[idx].wheel.style.transform = `rotate(${deg}deg)`;
    wheelElems[idx].digits.style.transform =
      `translateY(-${input[idx] * wheelElems[idx].digits.children[0].offsetHeight}px)`;
    playClick(240, 0.04);
  }

  function refreshAccumulator() {
    const wins = accContainer.querySelectorAll(".acc-window");
    if (!isSubtractionMode) {
      for (let i = 0; i < NUM; i++) wins[i].textContent = accumulator[i];
    } else {
      let currentVal = 0;
      for (let i = 0; i < NUM; i++) {
        currentVal += accumulator[i] * Math.pow(10, (NUM - 1) - i);
      }
      const maxPower = Math.pow(10, NUM);
      let compVal = (maxPower - currentVal) % maxPower;
      for (let i = 0; i < NUM; i++) {
        const digit = Math.floor(compVal / Math.pow(10, (NUM - 1) - i)) % 10;
        wins[i].textContent = digit;
      }
    }
  }

  function getEffectiveInput() {
    if (!isSubtractionMode) return [...input];
    let val = 0;
    for(let i=0; i<NUM; i++) val += input[i] * Math.pow(10, (NUM-1)-i);
    let max = Math.pow(10, NUM);
    let compVal = (max - val) % max;
    let compInput = [];
    for(let i=0; i<NUM; i++) {
      let d = Math.floor(compVal / Math.pow(10, (NUM-1)-i)) % 10;
      compInput.push(d);
    }
    return compInput;
  }

  function addInput() {
    const valuesToAdd = getEffectiveInput();
    let carry = 0;
    let anyCarry = false;
    for (let i = NUM - 1; i >= 0; i--) {
      const s = accumulator[i] + valuesToAdd[i] + carry;
      const newDigit = s % 10;
      carry = Math.floor(s / 10);
      if (carry > 0) anyCarry = true; 
      accumulator[i] = newDigit;
    }
    refreshAccumulator();
    resetInputWheels();
    if (anyCarry) {
      animateLever();
      playClick(180, 0.08);
    }
  }

  function resetInputWheels() {
    input = new Array(NUM).fill(0);
    wheelElems.forEach(w => {
      w.wheel.style.transform = `rotate(0deg)`;
      w.digits.style.transform = `translateY(0px)`;
    });
  }

  function clearAll() {
    accumulator = new Array(NUM).fill(9);
    refreshAccumulator();
    setTimeout(() => {
      let carry = 1;
      let anyCarry = true;
      for (let i = NUM - 1; i >= 0; i--) {
        const s = accumulator[i] + carry;
        const newDigit = s % 10;
        carry = Math.floor(s / 10);
        accumulator[i] = newDigit;
      }
      refreshAccumulator();
      if (anyCarry) {
        animateLever();
        playClick(180, 0.08);
      }
    }, 300);
  }

  function toggleSubtractionMode() {
    isSubtractionMode = !isSubtractionMode;
    if (isSubtractionMode) {
      compBar.style.display = "block";
      btnComp.classList.add("active-mode");
    } else {
      compBar.style.display = "none";
      btnComp.classList.remove("active-mode");
    }
    refreshAccumulator();
  }

  btnAdd.addEventListener("click", addInput);
  btnClear.addEventListener("click", clearAll);
  btnComp.addEventListener("click", toggleSubtractionMode);

  // Initialize
  initAccumulator();
  initWheels();
  refreshAccumulator();
</script>

<script>
  // Load shared footer
  fetch('footer.html')
      .then(response => response.text())
      .then(html => {
          document.getElementById('footer-container').innerHTML = html;
          // Run language detection after footer is loaded
          const lang = (document.documentElement.lang || 'en').substring(0, 2).toLowerCase();
          const validLang = ['de', 'en', 'es'].includes(lang) ? lang : 'en';
          document.querySelectorAll('.footer-text-de, .footer-text-en, .footer-text-es, .copyright-de, .copyright-en, .copyright-es').forEach(el => el.style.display = 'none');
          const textToShow = document.querySelector(`.footer-text-${validLang}`);
          const copyrightToShow = document.querySelector(`.copyright-${validLang}`);
          if (textToShow) textToShow.style.display = 'block';
          if (copyrightToShow) copyrightToShow.style.display = 'block';
      })
      .catch(err => console.error('Failed to load footer:', err));
</script>

</body>
</html>
